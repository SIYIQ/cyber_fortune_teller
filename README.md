# ğŸ”® èµ›åšç®—å‘½ç³»ç»Ÿ

åŸºäºCLIPæ¨¡å‹çš„å‘é‡ç©ºé—´ç›¸ä¼¼åº¦è®¡ç®—ç³»ç»Ÿï¼Œé€šè¿‡å°†ä¸¤ä¸ªäººçš„åå­—å’Œè„¸çš„å‘é‡æ‹¼æ¥åï¼Œè®¡ç®—ä»–ä»¬åœ¨é«˜ç»´ç©ºé—´ä¸­çš„ç›¸ä¼¼åº¦ã€‚

## æ ¸å¿ƒæ€æƒ³

1. **åå­—ç¼–ç **ï¼šä½¿ç”¨CLIPçš„æ–‡æœ¬ç¼–ç å™¨å°†äººåç¼–ç ä¸ºå‘é‡
2. **äººè„¸ç¼–ç **ï¼šä½¿ç”¨CLIPçš„å›¾åƒç¼–ç å™¨å°†äººè„¸ç…§ç‰‡ç¼–ç ä¸ºå‘é‡
3. **å‘é‡æ‹¼æ¥**ï¼šå°†æ¯ä¸ªäººçš„åå­—å‘é‡å’Œè„¸å‘é‡æ‹¼æ¥ï¼ˆcatï¼‰æˆä¸€ä¸ªç»„åˆå‘é‡
4. **ç›¸ä¼¼åº¦è®¡ç®—**ï¼šè®¡ç®—ä¸¤ä¸ªäººåœ¨é«˜ç»´ç©ºé—´ä¸­çš„ç›¸ä¼¼åº¦ï¼ˆä½™å¼¦ç›¸ä¼¼åº¦ã€ç‚¹ç§¯ã€æ¬§æ°è·ç¦»ç­‰ï¼‰
5. **ç®—å‘½ç»“æœ**ï¼šæ ¹æ®ç›¸ä¼¼åº¦ç”Ÿæˆæœ‰è¶£çš„"ç®—å‘½"ç»“æœ

## âš ï¸ é‡è¦å‰æå’Œé™åˆ¶

æ­£å¦‚ä½ æåˆ°çš„ï¼Œè¿™ä¸ªç³»ç»Ÿæœ‰å‡ ä¸ªé‡è¦çš„å‰æå’Œé™åˆ¶ï¼š

1. **åå­—å’Œè„¸ä¸ä¸€å®šèƒ½ä»£è¡¨äººè¿™ä¸ªä¸ªä½“**ï¼šCLIPæ¨¡å‹å¯èƒ½æ— æ³•å‡†ç¡®ç†è§£åå­—å’Œè„¸çš„è¯­ä¹‰å…³è”
2. **å›¾åƒåŸŸå¯èƒ½ä¸åŒ**ï¼šä¸åŒæ¥æºçš„ç…§ç‰‡ï¼ˆè¯ä»¶ç…§ã€ç”Ÿæ´»ç…§ã€è‰ºæœ¯ç…§ç­‰ï¼‰å¯èƒ½å½±å“ç»“æœ
3. **ä»…ä¾›å¨±ä¹**ï¼šæœ¬ç³»ç»ŸåŸºäºå‘é‡ç©ºé—´ç›¸ä¼¼åº¦ï¼Œä¸ä»£è¡¨çœŸå®çš„äººé™…å…³ç³»æˆ–æ€§æ ¼åŒ¹é…

## å®‰è£…

```bash
# å®‰è£…ä¾èµ–
pip install torch torchvision transformers pillow numpy
```

## ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œä½¿ç”¨

#### å•äººå¯¹ç®—
```bash
python cli.py \
    --name1 "å¼ ä¸‰" \
    --face1 path/to/person1.jpg \
    --name2 "æå››" \
    --face2 path/to/person2.jpg \
    --output result.json
```

#### æ‰¹é‡è®¡ç®—
é¦–å…ˆåˆ›å»ºæ‰¹é‡æ•°æ®JSONæ–‡ä»¶ `batch_data.json`:
```json
[
    {"name": "å¼ ä¸‰", "face_path": "path/to/person1.jpg"},
    {"name": "æå››", "face_path": "path/to/person2.jpg"},
    {"name": "ç‹äº”", "face_path": "path/to/person3.jpg"}
]
```

ç„¶åè¿è¡Œï¼š
```bash
python cli.py --batch --input batch_data.json --output similarity_matrix.json
```

### 2. Python APIä½¿ç”¨

```python
from fortune_teller import CyberFortuneTeller

# åˆå§‹åŒ–ç³»ç»Ÿ
fortune_teller = CyberFortuneTeller()

# è®¡ç®—ä¸¤ä¸ªäººçš„ç›¸ä¼¼åº¦
result = fortune_teller.tell_fortune(
    name1="å¼ ä¸‰",
    face1_path="path/to/person1.jpg",
    name2="æå››",
    face2_path="path/to/person2.jpg"
)

# æŸ¥çœ‹ç»“æœ
print(f"ç›¸ä¼¼åº¦: {result['similarity_scores']['cosine']:.4f}")
print(f"åŒ¹é…åº¦: {result['fortune']['compatibility']}")
print(f"æè¿°: {result['fortune']['description']}")
```

### 3. æ‰¹é‡è®¡ç®—ç›¸ä¼¼åº¦çŸ©é˜µ

```python
from fortune_teller import CyberFortuneTeller

fortune_teller = CyberFortuneTeller()

person_list = [
    ("å¼ ä¸‰", "path/to/person1.jpg"),
    ("æå››", "path/to/person2.jpg"),
    ("ç‹äº”", "path/to/person3.jpg"),
]

similarity_matrix = fortune_teller.batch_compute(person_list)
print(similarity_matrix)
```

## è¾“å‡ºç»“æœè¯´æ˜

### ç›¸ä¼¼åº¦åˆ†æ•°
- **ä½™å¼¦ç›¸ä¼¼åº¦** (cosine): èŒƒå›´ [-1, 1]ï¼Œå€¼è¶Šå¤§è¶Šç›¸ä¼¼
- **ç‚¹ç§¯ç›¸ä¼¼åº¦** (dot_product): æœªå½’ä¸€åŒ–çš„ç‚¹ç§¯
- **æ¬§æ°ç›¸ä¼¼åº¦** (euclidean_based): åŸºäºæ¬§æ°è·ç¦»è½¬æ¢çš„ç›¸ä¼¼åº¦ï¼ŒèŒƒå›´ [0, 1]

### åŒ¹é…åº¦ç­‰çº§
- **å¤©ä½œä¹‹åˆ** (â‰¥90åˆ†): é«˜åº¦ç›¸ä¼¼
- **éå¸¸åŒ¹é…** (80-89åˆ†): å¾ˆå¼ºçš„ç›¸ä¼¼æ€§
- **è¾ƒä¸ºåŒ¹é…** (70-79åˆ†): ä¸€å®šçš„ç›¸ä¼¼åº¦
- **ä¸­ç­‰åŒ¹é…** (50-69åˆ†): ä¸­ç­‰æ°´å¹³
- **ä¸å¤ªåŒ¹é…** (30-49åˆ†): å·®å¼‚è¾ƒå¤§
- **å·®å¼‚è¾ƒå¤§** (<30åˆ†): æ˜æ˜¾å·®å¼‚

## æŠ€æœ¯ç»†èŠ‚

### CLIPæ¨¡å‹
- é»˜è®¤ä½¿ç”¨ `openai/clip-vit-base-patch32`
- åµŒå…¥ç»´åº¦: 512
- å›¾åƒå°ºå¯¸: 224x224
- æ–‡æœ¬æœ€å¤§é•¿åº¦: 77 tokens

### å‘é‡æ‹¼æ¥æ–¹å¼
- åå­—å‘é‡: `[512]`
- äººè„¸å‘é‡: `[512]`
- æ‹¼æ¥å: `[1024]`

### ç›¸ä¼¼åº¦è®¡ç®—
æ‰€æœ‰ç›¸ä¼¼åº¦è®¡ç®—å‰éƒ½ä¼šå¯¹å‘é‡è¿›è¡ŒL2å½’ä¸€åŒ–ï¼Œç¡®ä¿ç»“æœçš„ä¸€è‡´æ€§ã€‚

## æ–‡ä»¶ç»“æ„

```
cyber_fortune_teller/
â”œâ”€â”€ fortune_teller.py    # æ ¸å¿ƒç®—å‘½ç³»ç»Ÿ
â”œâ”€â”€ cli.py               # å‘½ä»¤è¡Œç•Œé¢
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

## æ³¨æ„äº‹é¡¹

1. **å›¾åƒè´¨é‡**ï¼šå»ºè®®ä½¿ç”¨æ¸…æ™°ã€æ­£é¢çš„äººè„¸ç…§ç‰‡
2. **åå­—æ ¼å¼**ï¼šæ”¯æŒä¸­è‹±æ–‡åå­—ï¼Œä½†æ•ˆæœå¯èƒ½å› è¯­è¨€è€Œå¼‚
3. **è®¡ç®—èµ„æº**ï¼šé¦–æ¬¡è¿è¡Œä¼šä¸‹è½½CLIPæ¨¡å‹ï¼ˆçº¦600MBï¼‰
4. **GPUåŠ é€Ÿ**ï¼šå¦‚æœæœ‰GPUï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨CUDAåŠ é€Ÿ

## æ‰©å±•æƒ³æ³•

1. **å¤šæ¨¡æ€èåˆ**ï¼šå¯ä»¥å°è¯•å…¶ä»–èåˆæ–¹å¼ï¼ˆåŠ æƒå¹³å‡ã€æ³¨æ„åŠ›æœºåˆ¶ç­‰ï¼‰è€Œä¸æ˜¯ç®€å•æ‹¼æ¥
2. **ç‰¹å¾å¢å¼º**ï¼šå¯ä»¥æ·»åŠ æ›´å¤šç‰¹å¾ï¼ˆå¹´é¾„ã€èŒä¸šç­‰æ–‡æœ¬æè¿°ï¼‰
3. **å¯è§†åŒ–**ï¼šå¯ä»¥æ·»åŠ ç›¸ä¼¼åº¦çŸ©é˜µçš„çƒ­åŠ›å›¾å¯è§†åŒ–
4. **Webç•Œé¢**ï¼šå¯ä»¥å¼€å‘ä¸€ä¸ªç®€å•çš„Webç•Œé¢æ–¹ä¾¿ä½¿ç”¨

## å…è´£å£°æ˜

âš ï¸ **æœ¬ç³»ç»Ÿä»…ä¾›å¨±ä¹å’Œç ”ç©¶ä½¿ç”¨ï¼Œç»“æœä¸ä»£è¡¨çœŸå®çš„äººé™…å…³ç³»ã€æ€§æ ¼åŒ¹é…æˆ–ä»»ä½•ç§‘å­¦ä¾æ®ã€‚è¯·ç†æ€§å¯¹å¾…ç»“æœï¼Œä¸è¦ç”¨äºé‡è¦å†³ç­–ã€‚**

## License

MIT License

